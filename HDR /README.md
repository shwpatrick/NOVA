
# 明度 vs. 亮度（Lightness vs. Luminance）

在影像處理與人眼視覺中，**明度（lightness）** 和 **亮度（luminance）** 是不同的概念：

- **亮度（luminance）**：物理量，代表實際的光強度。
- **明度（lightness）**：人眼主觀感知的「亮」程度，具有視覺恆常性（constancy）。

>明度的恆常性不是絕對的（容易失效）
>恆常性是指即使環境光改變，我們仍能感知物體「一樣亮」。

---

## 以下情況會造成明度失真或恆常性失效：

- **視野變窄**：減少參照環境，恆常性降低
- **亮度動態範圍受限**：感知空間縮小，誤判亮暗
- **場景佔據視網膜區域大**：提供穩定參照 → 恆常性提升
- **同時對比效應**：明暗受到周圍顏色影響
- **Gelb 錯覺**：明暗認知錯位（某些裝置無法重現）

## 為什麼這與顯示設備有關？

 > 人眼會根據環境自動「調整」對光的敏感度，但螢幕不會。
 
 - 顯示裝置通常亮度範圍固定，無法觸發人眼對光的動態適應
- 所以為了讓畫面在螢幕上「看起來自然」，我們需要：
  - 模擬人眼對光的反應行為
  - 對影像進行預處理(tone-mapping)

---

# 人眼調光的邏輯

螢幕無法觸發人眼的調光反應，導致明度恆常性失效，因此須預先模擬此機制以改善影像感知。

## 1. 明度知覺理論（Lightness Perception Theory）

論述：人眼對於區域的明度感知取決於該區域與鄰近區域在邊界處的亮度比例。
## 2. 明度定位理論（Anchoring Theory）

論述：人眼將絕對亮度轉換為相對明度來進行感知。
## 3. 內在影像模型

影像可視為兩個主要組成層的相乘關係：

- **照明層（illumination layer）**：表示場景光照分佈，通常為低頻、高對比的成分。
- **反射層（reflectance layer）**： 表示物體表面的固有色與紋理，屬於高頻、低對比的成分。

> 概念釐清  
> - **照明層 → 低頻** -> 沒有細節、邊緣，控制整體明暗趨勢 -> 在頻域上表現為低頻成分（變化慢） 
> - **反射層 → 高頻** -> 物體邊緣、紋理、材質變化 -> 在頻域上表現為高頻成分（變化快）

> 這裡的照明層跟反射不是指主光源區域跟散射反射光源區域的關係，更像是圖形疊加

---

# 錨框（Anchoring Framework）

綜合前述概念，整體處理邏輯是：  
將畫面在全局與局部層次進行分區分層，針對每個區塊調整其明度，再重新組合還原出整張圖像。

這引出一個核心問題：  
演算法上如何將影像劃分為適當的局部區塊，並決定每一塊的「錨點亮度」？

---

## 錨定規則（Anchoring Rules）

所謂「錨點」，指的是該區域中**被視為白色或基準亮度**的參考值。  
目的是建立**亮度與明度之間的映射關係**，讓後續 tone mapping 有據可依。

根據人眼感知行為與實驗設計，主要錨定規則如下：

- **最高亮度規則**：視野中的最高亮度區域會被視為「白色」
- **平均亮度規則**：視野中的平均亮度被視為「中灰」

> 實驗結果表明：最高亮度規則更接近實際的人眼知覺

除了亮度本身，人眼對區域面積也有明顯感知偏好：

- 最高亮度區域 -> 傾向視為白色
- 最大面積區域 -> 傾向視為白色

綜合以上的概念可以提出一個整體性的結論

- 視野分區最大面積如果是 最高亮度區域 -> 是一個穩定的錨點（明度感知一致）
- 視野分區最大面積如果是 較暗亮度區域 -> 人眼會把畫面中的亮區視為自發光的光源（明度恆常性失效）

> 錨點不是單一亮度，而是加權平均亮度(面積比例加權)

---

## 複雜影像 -> 一個圖像包含多個框架 -> 錨定不能全局套

影像分成多個子區(框架)
相同照明 同一陰影下的物體條件 獨立應用錨框(有點忘記當時的概念、可能寫錯)
實際影像中可能有多個光源

框架可能疊加(單一像素、區塊受到多個框架影響)
整體明度 是 多個框架的加權(權重是區分度articulation)平均值

> 框架區分度、框架中亮度值的多樣性程度->透過計算動態範圍而來

- 框架中亮度變化小(變異度低) -> 整體明度影響小
- 框架中亮度變化大(變異度高) -> 整體明度影響大
